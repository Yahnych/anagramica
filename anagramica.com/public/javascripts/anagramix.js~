/****************************
 * ANAGRAMIX
 *
 *  Copyright 2011, Max Irwin (@binarymax)
 *  MIT License
 *
 ****************************/

"use strict";

var anagramix = window.anagramix;
anagramix = anagramix || {};
if (!anagramix.game) {

	anagramix.game = (function() {

		var score 			= 0;  //Player's running total score
		var boardletters 	= ""; //Letters currently on the board

		var consonants 	= "BCDFGHJKLMNPQRSTVWXYZ";
		var vowels 			= "AEIOU";
		
		//Gets a consonant and adds it to the board letters
		var getConsonant = function() {
			var letter = consonants[parseInt(Math.random()*consonants.length)];
			boardletters+=letter;
			return letter;
		};

		//Gets a vowel and adds it to the board letters
		var getVowel = function() {
			var letter = vowels[parseInt(Math.random()*vowels.length)];
			boardletters+=letter;
			return letter;
		};
		
		//Checks if a word is valid
		// First checks letters against the board
		// Then checks word against the dictionary
		var checkWord = function(word,callback) {

			var i=0,j=-1,
				w=word.toUpperCase(),
				a=boardletters.split(''),
				wl=word.length,
				bl=boardletters.length;

			while(i<wl && i<bl && (j=a.indexOf(w[i]))>-1) {
				//Letter found on the board, use it up!
				a.splice(j,1);
				i++;
			}
			
			if (i!==wl) {
				//Word contains letters not on the board
				callback(0);

			} else {
				//word only uses board letters.
				//check dictionary on server.
				$.ajax({
					url:"/lookup/" + word,
					type:"GET",
					timeout:1000*15,
					success:function(data,status,jqXHR){
						data = (typeof(data) === 'object')?data:JSON.parse(data);
						//Callback with word found in dictionary result
						callback(data.found);
					}
				});

			}
		};

		var getBest = function(callback) {
			$.ajax({
				url:"/best/" + boardletters,
				type:"GET",
				timeout:1000*15,
				success:function(data,status,jqXHR){
					data = (typeof(data) === 'object')?data:JSON.parse(data);
					//Callback with best possible words found in anagram result
					callback(data.best);
				}
			});
		
		};
		 
		return {
			getConsonant:getConsonant,
			getVowel:getVowel,
			getBest:getBest,
			checkWord:checkWord
		}
	})();
}

if (!anagramix.ui) {
	anagramix.ui = (function() {
		function addAnswer(){
		}
		
		var choose  = function(){};
		var onKey   = function(){};
		var onEnter = function(){};
		var freeze  = function(){};
		var clear   = function(){};
		
		return {}
	})();
}